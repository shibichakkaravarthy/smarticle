"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
//@ts-ignore
var Module = require("module");
var fileType = require("file-type");
var read_chunk_1 = require("read-chunk");
//@ts-ignore
var image_size_1 = require("image-size");
//@ts-ignore
var originalLoader = Module._load;
//@ts-ignore
Module._load = function (request, parent) {
    var buffer;
    try {
        buffer = read_chunk_1.default.sync(request, 0, fileType.minimumBytes);
    }
    catch (_a) {
        return originalLoader.apply(this, arguments);
    }
    var fullType = fileType(buffer);
    if (!fullType)
        return originalLoader.apply(this, arguments);
    var type = fullType.mime;
    if (type.split("/")[0] != "image")
        return originalLoader.apply(this, arguments);
    var size = image_size_1.default(request);
    return { uri: request, width: size.width, height: size.height };
};
